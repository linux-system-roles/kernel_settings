- hosts: all

  roles:
    - role: linux-system-roles.kernel_settings
      when: false

  tasks:
    - name: get and store config values from template machine
      kernel_report:
      register: template_settings
      when: inventory_hostname == 'template_machine'
      no_log: true

    - name: apply kernel_settings to target machine(s)
      include_role:
        name: linux-system-roles.kernel_settings
      vars:
          kernel_settings_sysctl: "{{ hostvars['template_machine'].template_settings.ansible_facts.sysctl }}"
      when: inventory_hostname == 'target_machine'
